<!DOCTYPE html>
<html lang="zh">

<head>
    <title>对话机器人</title>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self';">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <style>
        h1 {
            color: #353434;
            font-size: 30px;
            text-align: center;
        }

        h5 {
            color: #353434;
            font-size: medium-large;
            text-align: center;
            width: auto;
            height: 10px;
            margin-bottom: 10px;
            margin-top: -5px;
        }

        pre {
            background-color: #f5f5f5;
            border: 1px solid #ccc;
            padding: 10px;
        }

        code {
            font-family: "Courier New", monospace;
        }

        body {
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .message-container {
            margin: 10px 0;
            display: flex;
            justify-content: flex-end;
        }

        .message-container.user-message {
            justify-content: flex-start;
        }

        .message {
            padding: 10px;
            max-width: 70%;
            border-radius: 4px;
        }

        .user-message {
            background-color: #e6f5ff;
            color: #0066cc;
        }

        .bot-message {
            background-color: #f1f1f1;
            color: #333333;
        }

        .input-container {
            display: flex;
            margin-top: 20px;
        }

        .input-container input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            background-color: #f5f5f5;
        }

        .input-container button {
            padding: 10px 20px;
            margin-left: 10px;
            border: none;
            border-radius: 4px;
            background-color: #0066cc;
            color: #fff;
        }

        .title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: #333333;
        }

        .container asks {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .container details-section {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>对话机器人</h1>
        <div id="conversation"></div>
        <div class="input-container">
            <input type="text" id="input" placeholder="请输入问题">
            <button id="sendButton">发送</button>
        </div>
    </div>
    <div class="container details-section">
        <h2 style="color: #000000; font-size: medium; text-align: center;">更多详情</h2>
        <p>感谢您的支持！</p>
        <a href="https://dudulittle.mysxl.cn"
            style="font-size: small; color: darkgray; text-align: center;">如有bug，请到此处反馈！</a>
    </div>
    <div class="container asks">
        <div class="row">
            <div class="col-md-12" style="font-size: 20px; color: #666">
                <h5>请输入相关问题。如果你不知道要问啥，可以尝试以下问题：</h5>
                <ul>
                    <li>王翰茗是谁</li>
                    <li>凸(艹皿艹 )</li>
                    <li>yrn喜欢谁</li>
                </ul>
            </div>
            </code>
            </pre>
        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self'; upgrade-insecure-requests;">
<meta http-equiv="Content-Security-Policy" content="script-src 'self';">
<meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self';">
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<script>
    var newsList = []; // 保存新闻列表数据
    var isSelectingNewsType = false; // 是否正在选择新闻类型

    document.addEventListener('DOMContentLoaded', function () {
        document.addEventListener('click', function (event) {
            if (event.button !== 0) {
                event.preventDefault();
            }
        });

        document.addEventListener('contextmenu', function (event) {
            event.preventDefault();
        });
    });

    document.addEventListener('contextmenu', function (event) {
        event.preventDefault();
    });


    document.onkeydown = function (e) {
        if (e.keyCode === 123) {
            return false;
        }
    };

    document.addEventListener('contextmenu', function (e) {
        e.preventDefault();
    });

    document.addEventListener('keydown', function (event) {
        if (event.ctrlKey) {
            event.preventDefault();
        }
    });

    function getNewsList() {
        var apiURL = 'https://www.mxnzp.com/api/news/types/v2?app_id=nleephozzwjuomtt&app_secret=FrJopx8QTt8rSQJ3shWWgvovGAbuDAqw';

        fetch(apiURL)
            .then(response => response.json())
            .then(data => {
                if (data.code === 1) {
                    newsList = data.data;
                    addMessage('请选择要查看的新闻类型：', false);
                    // 显示供用户选择的新闻类型列表
                    for (var j = 0; j < newsList.length; j++) {
                        addMessage((j + 1) + '. ' + newsList[j].typeName, false);
                    }

                    isSelectingNewsType = true;
                } else {
                    addMessage('获取新闻类型列表失败', false);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
    function getNewsDetails(newsId) {
        var apiURL = 'https://www.mxnzp.com/api/news/details/v2?newsId=' + encodeURIComponent(newsId) + '&app_id=nleephozzwjuomtt&app_secret=FrJopx8QTt8rSQJ3shWWgvovGAbuDAqw';

        fetch(apiURL)
            .then(response => response.json())
            .then(data => {
                if (data.code === 1) {
                    var newsData = data.data;
                    // 处理新闻详情数据

                    // 示例代码：输出新闻内容
                    for (var i = 0; i < newsData.items.length; i++) {
                        addMessage(newsData.items[i].content, false);
                    }
                } else {
                    addMessage('获取新闻详情失败', false);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    $(document).ready(function () {
        $('#input').keypress(function (e) {
            if (e.which === 13) {
                sendMessage();
            }
        });

        $('#sendButton').click(function () {
            sendMessage();
        });

        function sendMessage() {
            var inputElement = document.getElementById('input');
            var message = inputElement.value;
            inputElement.value = '';

            if (message.trim() !== '') {
                addMessage(message, true);

                if (message.includes('天气')) {
                    var city = message.replace('天气', '').trim();
                    getWeather(city);
                } else if (message.includes('段子')) {
                    getJoke();
                } else if (message.includes('新闻')) {
                    getNewsList();
                } else if (isSelectingNewsType && !isNaN(message)) {
                    var index = parseInt(message) - 1;
                    if (index >= 0 && index < newsList.length) {
                        var selectedNews = newsList[index];
                        addMessage('您选择的是：' + selectedNews.typeName, false);
                        getNewsDetails(selectedNews.typeId);
                    } else {
                        addMessage('无效的选项，请重新选择！', false);
                    }
                    isSelectingNewsType = false;
                } else {
                    // 仅当消息包含关键词“ChatGPT”时调用 ChatGPT API
                    if (message.toLowerCase().includes('chatgpt')) {
                        getChatGPTReply(message);
                    } else {
                        getBotReply(message);
                    }
                }
            }
        }

        function getWeather(city) {
            var apiURL = 'https://www.mxnzp.com/api/weather/current/' + encodeURIComponent(city) + '?app_id=nleephozzwjuomtt&app_secret=FrJopx8QTt8rSQJ3shWWgvovGAbuDAqw';

            fetch(apiURL)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 1) {
                        var weatherInfo = data.data.address +
                            "，当前温度" + data.data.temp + "，" +
                            "现在是" + data.data.weather + "天，" +
                            "刮" + data.data.windDirection + "风，" +
                            "风力" + data.data.windPower + "，"
                        "当前湿度为" + data.data.humidity + "。"

                        addMessage(weatherInfo, false);
                    } else {
                        addMessage('获取天气信息失败，请确认城市名称是否正确。', false);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function getJoke() {
            var apiURL = 'https://www.mxnzp.com/api/jokes/list?page=1&app_id=nleephozzwjuomtt&app_secret=FrJopx8QTt8rSQJ3shWWgvovGAbuDAqw';

            fetch(apiURL)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 1) {
                        var jokes = data.data.list;
                        if (jokes.length > 0) {
                            var randomIndex = Math.floor(Math.random() * jokes.length);
                            var joke = jokes[randomIndex];

                            var jokeInfo = "好的！" + joke.content

                            addMessage(jokeInfo, false);
                        } else {
                            addMessage('暂时没有段子', false);
                        }
                    } else {
                        addMessage('获取段子失败', false);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function getBotReply(message) {
            var apiURL = 'https://api.ownthink.com/bot?appid=345f56b593f3c6ead0749ee05ed709f8';
            var userId = '0mMcxdKv';
            var spoken = encodeURIComponent(message);
            var url = apiURL + '&userid=' + userId + '&spoken=' + spoken;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    var reply = data.data.info.text;
                    addMessage(reply, false);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function getChatGPTReply(message) {
            var chatGPTApiURL = 'https://api.example.com/chatgpt';
            var apiKey = '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';

            fetch(chatGPTApiURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + apiKey,
                },
                body: JSON.stringify({ message: message }),
            })
                .then(response => response.json())
                .then(data => {
                    var reply = data.response; // 根据API响应格式调整此处
                    addChatGPTReply(reply);
                })
                .catch(error => {
                    console.error('错误:', error);
                });
        }

        function addChatGPTReply(reply) {
            var chatGPTResponseContainer = document.getElementById('chatGPTResponse');
            var replyElement = document.createElement('div');
            replyElement.classList.add('message-container');
            replyElement.classList.add('bot-message');
            var replyContent = document.createElement('div');
            replyContent.classList.add('message');
            replyContent.innerText = reply;
            replyElement.appendChild(replyContent);
            chatGPTResponseContainer.appendChild(replyElement);
        }

        function addMessage(message, isUser) {
            var messageContainer = document.getElementById('conversation');
            var messageElement = document.createElement('div');
            messageElement.classList.add('message-container');
            if (isUser) {
                messageElement.classList.add('user-message');
            } else {
                messageElement.classList.add('bot-message');
            }
            var messageContent = document.createElement('div');
            messageContent.classList.add('message');
            messageContent.innerText = message;
            messageElement.appendChild(messageContent);
            messageContainer.appendChild(messageElement);
        }
    });
</script>
</body>

</html>
